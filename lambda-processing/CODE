import json
import boto3

s3 = boto3.client('s3')

CONSUMPTION_BUCKET = "ecommerce-consumption-zone-anthony"

def lambda_handler(event, context):
    bucket = event["detail"]["bucket"]["name"]
    key = event["detail"]["object"]["key"]

    response = s3.get_object(Bucket=bucket, Key=key)
    data = json.loads(response["Body"].read())

    output = {
        "order_id": data["order_id"],
        "amount": data["amount"],
        "processed_via": "EventBridge"
    }

    s3.put_object(
        Bucket=CONSUMPTION_BUCKET,
        Key=f"aggregated/{data['order_id']}.json",
        Body=json.dumps(output)
    )

    return {"status": "processed via EventBridge"}
